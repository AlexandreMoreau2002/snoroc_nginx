# Bloquer les user agents suspects (on tolère curl/wget pour ops/health-check)
if ($http_user_agent ~* (bot|crawler|spider|scraper|python|java|go-http)) {
    return 403;
}

# Bloquer les requêtes sans user agent
if ($http_user_agent = "") {
    return 403;
}

# Bloquer les méthodes HTTP non autorisées
if ($request_method !~ ^(GET|POST|PUT|PATCH|DELETE|OPTIONS|HEAD)$) {
    return 405;
}

# Protection contre les injections dans les URLs
# On cible uniquement des patterns typiques d'injections SQL/XSS pour ne pas bloquer des routes légitimes comme /news/update.
if ($request_uri ~* "(union|select|insert|drop|concat|script|alert)") {
    return 403;
}
